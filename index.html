<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>携帯分解プロトタイプ（ネジ付き）</title>
  <style>
    .tool-btn { margin: 5px; padding: 8px; cursor: pointer; }
    .part { margin: 10px; padding: 10px; border: 1px solid #999; width: 200px; position: relative; }
    .disabled { opacity: 0.5; pointer-events: none; }
    .screw { width: 20px; height: 20px; background: gray; border-radius: 50%; position: absolute; cursor: pointer; }
    #screw1 { top: 0; left: 0; }
    #screw2 { top: 0; right: 0; }
    #screw3 { bottom: 0; left: 0; }
    #screw4 { bottom: 0; right: 0; }
    #log { margin-top: 20px; color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h2>工具を選ぶ</h2>
  <button class="tool-btn" onclick="selectTool('plus')">プラスドライバー</button>
  <button class="tool-btn" onclick="selectTool('plastic')">プラスチック工具</button>

  <h2>パーツを外す</h2>
  <div class="part" id="lcd">
    液晶パネル
    <div class="screw" id="screw1" onclick="removeScrew(1)"></div>
    <div class="screw" id="screw2" onclick="removeScrew(2)"></div>
    <div class="screw" id="screw3" onclick="removeScrew(3)"></div>
    <div class="screw" id="screw4" onclick="removeScrew(4)"></div>
  </div>
  <div class="part disabled" id="battery" onclick="removePart('battery')">電池パック</div>

  <div id="log"></div>

  <script>
    let selectedTool = null;
    let screwState = [false, false, false, false]; // 4本のネジ
    let lcdRemoved = false;

    function selectTool(tool) {
      selectedTool = tool;
      logMsg(`工具「${tool === 'plus' ? 'プラスドライバー' : 'プラスチック工具'}」を選びました`);
    }

    function removeScrew(index) {
      if (selectedTool !== 'plus') {
        return logMsg("このネジはプラスドライバーでないと外せません！");
      }
      const screwEl = document.getElementById(`screw${index}`);
      if (!screwState[index - 1]) {
        screwState[index - 1] = true;
        screwEl.style.display = 'none';
        logMsg(`ネジ${index}を外しました`);

        if (screwState.every(s => s)) {
          document.getElementById('lcd').onclick = () => removePart('lcd');
          logMsg("全てのネジを外しました！液晶パネルが外せます！");
        }
      }
    }

    function removePart(part) {
      if (part === 'lcd') {
        lcdRemoved = true;
        document.getElementById('lcd').classList.add('disabled');
        document.getElementById('battery').classList.remove('disabled');
        return logMsg("液晶パネルを外しました！");
      }

      if (part === 'battery') {
        if (!lcdRemoved) return logMsg("液晶パネルを先に外してください！");
        if (selectedTool !== 'plastic') {
          return logMsg("電池パックにはプラスチック工具が必要です！");
        }
        document.getElementById('battery').classList.add('disabled');
        return logMsg("電池パックを外しました！");
      }
    }

    function logMsg(msg) {
      document.getElementById('log').innerText = msg;
    }
  </script>
</body>
</html>
